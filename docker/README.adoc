integration-ops@recordedfuture.com# Docker support for Phantom development

The Phantom install script prompts for a my.phantom.us set of credentials.
Rather than to fight this we're building images manually and storing them
in Recorded Future's Docker registry.

## Build an image

. Build a Centos/systemd image: +
  `docker build -t phantom-manual:5.1 -f phantom_5.1/Dockerfile .`
. Install the Application RPM file
.. Start up the container: +
   `docker run -it -d --cap-add=ALL \
   --name rf_phantom \
   --hostname phantosd \
   -p "80:80" \
   -p "443:443" \
   phantom-manual:5.1`
.. Start a new shell and jump into the container: +
   `docker exec -it rf_phantom /bin/bash`
.. Run the install script: +
   `/opt/phantom/bin/phantom_setup.sh install --no-prompt --no-space-check` +
   After a while the script will prompt for credentials to my.phantom.us. Look in
   LastPass for "Phantom Login Credentials" (username: integration-ops@recordedfuture.com)
.. Optional: Enabling backup/restore functionallity: +
   `phenv python3 /opt/phantom/bin/ibackup.pyc --setup`
.. Execute curl command to allow anyone to talk to the instance: +
   `curl -g -k -X POST https://localhost/rest/ph_user/2 -u 'admin:password' -d '{"allowed_ips": ["any"]}'`
.. Install the license in the GUI, Credentials can be found in LastPass as "Phantom license -"
.. Exit the docker shell: +
   `exit`
.. Make a note of the container id, it's shown in the prompt of the shell or when executing: +
   `docker ps`
.. Shut the system down: +
   `docker stop rf_phantom`
. Turn the container into an image: +
  `docker commit <container_id> registry.recfut.com/rf/application/main/integrations/phantom:5.1`
. Push the image to the Gitlab registry: +
.. Login to our gitlab server: +
  `docker login registry.recfut.com`
.. Push the newly created docker image to our registry: +
  `docker push registry.recfut.com/rf/application/main/integrations/phantom:5.1`

## Using an image

Best way to use the image is by start it with `docker-compose up -d rf_phantom` or you can also execute: +
`docker run -it -d --cap-add=ALL \
 -p "2022:22" -p "80:80" -p "443:443" \
 registry.recfut.com/rf/application/main/integrations/phantom:5.1`

Default account and password: admin / password
